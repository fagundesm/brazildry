{
    "collab_server" : "",
    "contents" : "library(dplyr)\nlibrary(reshape2)\n\nBD <-read.csv(\"data/BD_17-18.csv\")\nBD <- arrange(BD, ano, plot, linha, planta)\nstr(BD)\n#BD <- filter(BD, div != \"ctrl\") \n\n                                      #TABELAS COM VALORES DE CRESCIMENTO PARA CADA PLANTA \n# Um objeto para cada ano\ncr  <- select(BD, ano, linha, plot, div, planta, especie, status, altura,n_fol, LA, biomassa)\na17 <- filter(cr, ano == \"2017\"); arrange(a17, ano, plot, linha, planta)\na18 <- filter(cr, ano == \"2018\"); arrange(a18, ano, plot, linha, planta)\n\n# Verificar se as plantas estão alinhadas\nsummary(a17$planta == a18$planta)\n\n#colocando as planilhas paralelas.\nbrazilD<- cbind(a17, a18)\n\ncolnames(brazilD) <- c(\"ano\",\"linha\",\"plot\",\"div\",\"planta\",\"especie\",\"status\",\"altura\",\"n_fol\",\"LA\",\"biomassa\",\n                    \"ano1\",\"linha1\",\"plot1\",\"div1\",\"planta1\",\"especie1\",\"status1\",\"altura1\",\"n_fol1\",\"LA1\",\"biomassa1\")\n\n#brazilD <- filter(tent, status1==\"V\")\n\n#Diferença entre tempo 0 e tempo 1 altura em metros\nbrazilD$cresc.altura <- brazilD$altura1 - brazilD$altura\n  \n#Diferença entre tempo 0 e tempo 1 número de folhas\nbrazilD$cresc.nfol <- brazilD$n_fol1 - brazilD$n_fol\n\n#Crescimento em área foliar em  mm²\nbrazilD$cresc.LA <- brazilD$cresc.nfol*brazilD$LA\n\n#Crescimento em biomassa em g\nbrazilD$cresc.biomassa <- brazilD$cresc.nfol*brazilD$biomassa\n\n#write.csv(brazilD, \"BDcrescimento.csv\")\n                                                      \n                                                          #TABELA COM VALORES POR PLOT  \n#CRESCIMENTO\n# Média de crescimento por parcela\ncresc1 <- select(brazilD, plot, div, cresc.altura, cresc.nfol, cresc.LA, cresc.biomassa)\ncresc1$plot <- as.factor(cresc1$plot)\n\ncresc <-  cresc1 %>% group_by(plot, div) %>% \n  summarise_all(funs(mean(., na.rm = TRUE)))\n\nwrite.csv(cresc, \"BDcrescimento_por_plot.csv\")\n\n\n# Média de crescimento por espécie por parcela\ncresc2 <- select(brazilD, plot, especie, div, cresc.altura, cresc.nfol, cresc.LA, cresc.biomassa)\ncresc2$plot <- as.factor(cresc1$plot)\n\ncresc2 <-  cresc2 %>% group_by(plot, div, especie) %>% \n  summarise_all(funs(mean(., na.rm = TRUE)))\n\nwrite.csv(cresc2, \"BDcrescimento_por_sp_por_plot.csv\")\n\n#FACILITAÇÃO\n#média de facilitação por parcela. \nfacilitação <- select(a17, plot, div, fac_cresc, fac_sob, fac_tot)\n\nfac <-  facilitação %>% group_by(plot, div) %>% \n  summarise_all(funs(mean(., na.rm = TRUE)))\n\n#SOBREVIVÊNCIA\n#Calculo da sobrevivência em 2 anos.\n#Registro de moratalidade em dois anos. As plantas mortas em 2017, permanecem como mortas em 2018. \n##Porcentagem de sobrevivêmcia da parcela. \n\nmor  <- select(BD, ano, linha, plot, div, planta, especie, status)\nm17 <- filter(mor, ano == \"2017\"); arrange(m17, ano, plot, linha, planta)\nm18 <- filter(mor, ano == \"2018\"); arrange(m18, ano, plot, linha, planta)\n\nmortalidade <- cbind(m17, m18)\n\n# Verificar se as plantas estão alinhadas\nsummary(m17$planta == m18$planta)\n\ncolnames(mortalidade) <- c(\"ano\",\"linha\",\"plot\",\"div\",\"planta\",\"especie\",\"status\",\n                       \"ano1\",\"linha1\",\"plot1\",\"div1\",\"planta1\",\"especie1\",\"status1\")\n\n#Criando uma nova coluna com o cálculo de mortalidade única, considerando 2017 e 2018\nnewdata <- mutate(mortalidade, vm = ifelse(c(status1 == \"V\" & status ==\"V\" ), \"V\", \"M\"))\n\n#Porcentagem de sobrevivencia por espécie por parcela. \nmortas <- with(newdata,aggregate(newdata[,\"vm\"],list(plot,div,especie),table))\nmortas <- data.frame(mortas[,1:3],mortas[,4][,1],mortas[,4][,2])\ncolnames(mortas)<-c(\"plot\",\"div\",\"especie\",\"M\",\"V\")\n\nmortas <- arrange(mortas, plot, div, especie, M, V)\nmortas$total <- (mortas$V + mortas$M)\nmortas$sob_porc_especie <- (mortas$total - mortas$M)/mortas$total\nwrite.csv(mortas, \"sobrev_epecieporparcela.csv\")\n\n#Porcentagem de sobrevivência por espécie no experimento todo\nsobrev_especies <- summarise(group_by(mortas, especie),\n                             mortas=sum(M),\n                             vivas=sum(V),\n                             total=sum(total))\nsobrev_especies$sobrev_porc <- (sobrev_especies$total - sobrev_especies$mortas)/sobrev_especies$total\nwrite.csv(sobrev_especies, \"sobrev_experimento.csv\")\n\n#Porcentagem de sobrevivencia por espécie geral em todo experimento. \nmortast <-with(newdata,aggregate(newdata[,\"vm\"],table))\nmortast <-data.frame(mortast[,1],mortast[,2][,1],mortast[,2][,2])\ncolnames(mortast)<- c(\"ano\", \"M\", \"V\")\n\n#Porcentagem de sobrevivencia por  parcela. \nmortasp <- with(newdata,aggregate(newdata[,\"vm\"],list(plot,div),table))\nmortasp <- data.frame(mortasp[,1:2],mortasp[,3][,1],mortasp[,3][,2])\ncolnames(mortasp)<-c(\"plot\",\"div\",\"M\",\"V\")\nmortasp<- arrange(mortasp, plot, div, M, V)\nmortasp$total <- (mortasp$V + mortasp$M)\nmortasp$sob_porc_parcela <- (mortasp$total - mortasp$M)/mortasp$total\nwrite.csv(mortasp, \"sobrev_por_parcela.csv\")\n\n\n",
    "created" : 1536695305378.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4095286722",
    "id" : "7395CB81",
    "lastKnownWriteTime" : 1536695347,
    "last_content_update" : 1536695347955,
    "path" : "~/Dropbox/brazildry/manipulacao.R",
    "project_path" : "manipulacao.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}